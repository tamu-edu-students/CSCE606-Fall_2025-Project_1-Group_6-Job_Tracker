<div class="container mt-4">

    <% if notice %>
      <div class="alert alert-success"><%= notice %></div>
    <% elsif alert %>
      <div class="alert alert-danger"><%= alert %></div>
    <% end %>

    

  <div class="d-flex justify-content-between align-items-center mt-4">
    <h1 class="page-title mb-0">My Job Applications</h1>
    <div class="d-flex align-items-center">
        <!-- Export Button -->
        <%= link_to "New Job Application", new_job_path, class: "btn btn-outline-primary me-3 btn-sm" %>
        <%= link_to "Export Jobs (CSV)", export_jobs_path, class: "btn btn-outline-primary me-3 btn-sm" %>

        <!-- Import Form -->
        <%= form_with url: import_jobs_path,
                  method: :post,
                  html: { multipart: true, data: { turbo: false }, class: "d-flex align-items-center" } do %>
      <input type="file"
             name="file"
             accept=".csv"
             class="form-control form-control-sm me-2"
             required>
      <%= submit_tag "Import Jobs", class: "btn btn-outline-primary btn-sm" %>
    <% end %>
      </div>
    
  </div>
  <hr>
  <small class="text-muted">
      <em>Upload a CSV file (max 10 rows). Columns: title, company, link, deadline, status, notes.<br>
      Companies not found will be created automatically.</em>
    </small>
  <hr>

  <div class="mb-3 text-center">
    <div class="btn-group" role="group" aria-label="Status filters">
      <%= link_to "All", jobs_path(request.query_parameters.except(:status)), class: "btn #{params[:status].blank? || params[:status] == 'all' ? 'btn-primary' : 'btn-outline-primary'}" %>

      <% Job.statuses.each_key do |status| %>
        <%= link_to status.humanize, jobs_path(request.query_parameters.merge(status: status)), class: "btn #{params[:status] == status ? 'btn-primary' : 'btn-outline-primary'}" %>
      <% end %>
    </div>
  </div>
  <div class="mb-3" data-controller="job-search">
    <%= form_with url: jobs_path, method: :get, local: true, html: { class: 'd-flex' } do |f| %>
      <div class="input-group w-100">
        <%= f.text_field :q, value: params[:q], placeholder: 'Search jobs by title or company...', class: 'form-control', data: { 'job-search-target': 'input' } %>
        <%= f.submit 'Search', class: 'btn btn-primary', data: { action: 'job-search#search' } %>
      </div>
    <% end %>
  </div>

  <% if @jobs.any? %>
    <table class="table table-hover" id="jobs-table">
      <thead class="thead-dark">
      <tr>
        <th>
          <%= link_to "Title #{sort_indicator("title", params[:sort], params[:direction])}".html_safe,
                      jobs_path(sort: "title", direction: next_direction("title", params[:sort], params[:direction])),
                      data: { turbo_frame: "jobs_table" } %>
        </th>
        <th>
          <%= link_to "Company #{sort_indicator("company", params[:sort], params[:direction])}".html_safe,
                      jobs_path(sort: "company", direction: next_direction("company", params[:sort], params[:direction])),
                      data: { turbo_frame: "jobs_table" } %>
        </th>
        <th>
          <%= link_to "Status #{sort_indicator("status", params[:sort], params[:direction])}".html_safe,
                      jobs_path(sort: "status", direction: next_direction("status", params[:sort], params[:direction])),
                      data: { turbo_frame: "jobs_table" } %>
        </th>
        <th>
          <%= link_to "Deadline #{sort_indicator("deadline", params[:sort], params[:direction])}".html_safe,
                      jobs_path(sort: "deadline", direction: next_direction("deadline", params[:sort], params[:direction])),
                      data: { turbo_frame: "jobs_table" } %>
        </th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <%= render partial: "rows", locals: { jobs: @jobs } %>
      </tbody>
    </table>
  <% else %>
    <p>No job applications found matching your criteria.</p>
  <% end %>

  <div class="mt-4 d-flex justify-content-center">
    <%= link_to "Return to Dashboard", dashboard_path, class: "btn btn-secondary" %>
  </div>

</div>
